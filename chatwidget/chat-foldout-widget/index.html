<!DOCTYPE html>
<html lang="da">
<head>
<meta http-Equiv="Cache-Control" content="no-cache" />
<meta http-Equiv="Pragma" content="no-cache" />
<meta http-Equiv="Expires" Content="0" />
<title>KRAM Grouppechat</title>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/chathelper.js"></script>
<link href='css/chat.widget.css' rel='stylesheet' type='text/css'>

<script>
// Remember that you can't rely on jQuery or now.js being available from the start

// Getting the basic connection parameters from the URL
getURLParameter = function (name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
}

var baseURL = getURLParameter("base_url") || "http://kram.curachat.com";
var port = getURLParameter("port") || "3002";

var poll;
var timeout = 50; // 5 seconds timeout

/**
 * Testing if now.js script is being loaded - if not, stop trying
 */
poll = function () {
  setTimeout(function () {
    timeout--;
    if (typeof now !== 'undefined') {
      // External source now.js loaded, time to load the chat status
      var chatstatus_script = document.createElement("script");
      chatstatus_script.type = "text/javascript";
      chatstatus_script.src = "js/chatstatus_group.js";
      document.body.appendChild(chatstatus_script);
      return;
    }
    else if (timeout > 0) {
      poll();
      $('.status-tab').removeClass('chat-closed chat-open').addClass('chat-busy');
    }
    else {
      // External source now.js failed to load, stop trying...
      $('.status-tab').removeClass('chat-busy chat-open').addClass('chat-closed');
      window.stop();
      console.log("now.js could not be loaded. Check if the Node server is running and verify port number.")
      return;
    }
  }, 50);
};

poll();

// Appending the now.js script to the DOM
$(document).ready(function() {
  var now_script = document.createElement("script");
  now_script.type = "text/javascript";
  now_script.src = baseURL + ":" + port + "/nowjs/now.js";
  document.body.appendChild(now_script);
});
</script>

</head>
<body>
  <div class="status-wrapper">
    <div class="col-1">
      <div class="status-tab chat-busy"></div>
    </div>
    <div class="col-2">
      <div class="status-content">
        <div class="status-info">
          <p>Velkommen til KRAM-gruppechat.</p>
          <p> &Aring;bningstider:</p>
          <ul> 
            <li>Mandag 18-21</li>
          </ul>
        </div>
        <a id="join-group-chat" class="btn groupchat hide" href="#">G&aring; til gruppechat</a>
      </div>
    </div>
  </div>
</body>
</html>